# 对比

| 存储方案 | 容量限制 | 生命周期 | 作用域 | 同步性 | 数据结构 | 性能 | 安全性
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
Cookie | 4KB/域名 | 可设置，默认会话 | 由Domain + Path决定 | 同步 | 键值对字符串 | 差 | 低（易受XSS和CSRF攻击）
LocalStorage | 5MB/域名 | 持久 | 同源 | 同步 | 键值对字符串 | 中 | 中
SessionStorage | 5MB/域名 | 会话 | 同源（仅当前标签页，关闭则被清理） | 同步 | 键值对字符串 | 中 | 中
IndexedDB | 对于整个浏览器，通常是硬盘剩余可用空间的 50% | 持久 | 同源 | 异步 | 对象存储 | 高 | 中
Cache API | 同IndexedDB | 持久 | Service Worker | 异步 | Request/Response | 高 | 高

同源：协议、域名、端口号必须一模一样

同域与同站的区别：
同域：协议、域名、端口号必须一模一样，否则就是跨域
同站：站一模一样，“站”是由 “有效顶级域名 + 二级域名”（学术上称为 eTLD+1）决定的，如果不一样就是跨站
公式：eTLD+1
- eTLD (Effective Top-Level Domain)：有效顶级域名。例如 .com, .org, .cn, 甚至包括 .co.uk, .github.io 这种长尾后缀。
- +1：在这个后缀前面的那一级域名（通常是你花钱买的那个名字）。
举个栗子： 对于 https://www.taobao.com：
eTLD 是 .com
+1 是 taobao
也就是它的“站”是 taobao.com，举例：www.taobao.com 和 m.taobao.com 属于同站


# cookie
生命周期：

- 会话级，当前会话结束之后删除
- 持久性，可设置Expires（指定日期）或Max-Age（有效期，单位是秒）


属性：
- Domain: 域名，例如crm.sankuai.com，也可以是.sankuai.com
- Path: URL路径，一般为/
- HttpOnly: 不允许js访问，即document.cookie无法访问，可防止 XSS 攻击
- Secure: 允许仅在 HTTPS 下传输
- SameSite: 控制 cookie 在跨站场景下是否发送
- Cross Site

## SameSite 理解
SameSite 属性用来控制跨站请求发送 cookie 的行为。同站请求一定会发送 cookie。
如何判断是否跨站？
首先得判断请求的发送方和接收方是什么，其次判断是否属于同站，以下展示具体的场景：
1. 顶部导航：页面跳转，比如点击超链接、表单提交(GET/POST)、JS脚本跳转
   1. 发送方：当前页面，接收方就是跳转的目标页面
2. 子资源加载：图片/脚本/样式、iframe嵌入
   1. 发送方：当前页面，接收方是资源
3. 异步请求：AJAX、Fetch
   1. 发送方：当前页面，接收方是当前请求

- Strict: 严格模式，禁止跨站请求发送 cookie
- Lax: 宽松模式，允许部分跨站请求发送 cookie，要求：必须是顶级导航，且请求方法必须安全（GET或HEAD）才允许发送cookie
- None: 宽松模式，允许跨站请求发送 cookie


常见场景举例：
1.页面A预加载(<link rel="prerender">)页面B，A和B属于跨站，若SameSite=Strict，则页面B不携带cookie；若SameSite=Lax，则页面B携带cookie，因为预加载也是为了后续快速打开页面B；若SameSite=None，则页面B携带cookie
2.页面A通过iframe嵌入页面B，A和B属于跨站，若SameSite=Lax，则页面B不携带cookie，页面B内部发起异步请求，若异步请求与页面B输入同站，则即使SameSite设置为Strict，异步请求也会携带cookie


# Cache API
专门为 Service Workers 设计，用于存储网络请求及其对应的响应。

特点：主要用于实现 PWA 的离线访问功能，存储资源文件（HTML/JS/CSS/Image）