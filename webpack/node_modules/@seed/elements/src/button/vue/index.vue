<template>
  <!-- 文字按钮 -->
  <a
    v-if="type === 2"
    @click="handleClick"
    :class="type2classes"
    :style="style"
  >
    <slot></slot>
  </a>
  <!-- 悬浮按钮 -->
  <div
    v-else-if="type === 3"
    @click="handleClick"
    :class="type3classes"
    :style="style"
  >
    <slot></slot>
  </div>
  <!-- 普通按钮 -->
  <div
    v-else-if="type === 1"
    :class="classes"
    @touchstart="touchStart"
    @touchend="touchEnd"
  >
    <slot></slot>
  </div>
</template>

<script>
import '../style/index.less';
import { prefixCls } from '@seed/ui-base';
export default {
  name: 'button',
  props: {
    type: {
      type: Number,
      default: 1,
    },
    level: {
      type: Number,
      default: 1,
    },
    state: {
      type: String,
      default: '', //按钮的四种状态，
    },
    size: {
      type: String,
      validator: function(value) {
        return ['l', 's', 'm'].indexOf(value) > -1;
      },
    },
    icon: {
      type: Element,
      default: null,
    },
    styles: {
      type: Object,
    },
    text: {
      type: String,
    },
  },
  data() {
    return {
      press: false,
    };
  },
  computed: {
    classes() {
      return [
        prefixCls(`btn`),
        prefixCls(this.getBtnStyle),
        this.size ? prefixCls(`size_${this.size}`) : prefixCls('size_m'),
      ];
    },
    type2classes() {
      return [
        prefixCls('btn', 'type2'),
        prefixCls('btn', 'type2', `sub${this.subType}`),
        {
          [prefixCls('bold')]: this.bold,
        },
      ];
    },
    type3classes() {
      return [
        prefixCls('btn', 'type3'),
        prefixCls('btn', 'type3', `sub${this.subType}`),
        {
          [prefixCls('bold')]: this.bold,
        },
      ];
    },
    getBtnStyle() {
      // debugger
      const { press, level } = this;
      let state = press ? 'press' : this.state;
      // 状态、层级都为空
      if (!state && level) {
        return `btn${level}`;
      }
      if (state) {
        const lv = level ? level : 1;
        switch (state) {
          case 'normal':
            return `btn${lv}`;
          case 'press':
            return `btn${lv}_press`;
          case 'awaiting':
            return `btn${lv}_await`;
          case 'disable':
            return `btn_disable`;
        }
      }
      return `btn1`;
    },
  },
  methods: {
    handleClick(e) {
      this.$emit('click', e, this);
    },
    touchStart(e) {
      if (this.state == 'disable') return;
      this.press = true;
      // this.$emit('click', e, this);
    },
    touchEnd(e) {
      if (this.state == 'disable') return;
      this.press = false;
      this.$emit('click', e, this);
    },
  },
};
</script>
