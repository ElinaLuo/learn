<template>
  <div :class="classes.slider">
    <div :class="classes.progress" ref="progressEl">
      <div
        :class="classes.progressInactive"
        :style="'left: ' + handlerX + 'px'"
      ></div>
    </div>
    <div :class="classes.marks">
      <div
        :class="classes.markItem"
        :key="index"
        @click="handleMarkClick"
        :data-index="index"
        :style="'left: ' + (index / (marks.length - 1)) * 100 + '%'"
        v-for="(mark, index) in marks"
      >
        <div
          :class="classes.markPoint"
          :style="
            'backgroundColor: ' +
              (index <= currentValue ? colorStops[index] : '')
          "
        ></div>
        <div
          :class="classes.markText"
          :style="'color: ' + (index <= currentValue ? '#f63' : '')"
        >
          {{ mark.label }}
        </div>
      </div>
    </div>
    <div
      ref="handlerEl"
      :class="classes.handler"
      @touchstart="handleTouchStart"
      @touchmove="handleTouchMove"
      @touchend="handleTouchEnd"
      :style="'left: ' + (handlerX + handlerWidth / 2) + 'px'"
    >
      <div :class="classes.handlerBar"></div>
    </div>
  </div>
</template>

<script>
import '../style/slider.less';
import { NOOP } from '@seed/ui-base/es/const.js';
import { mixin } from '../common/mixin.js';
import getColorStops from '@dp/util-color';

export default {
  name: 'slider',
  props: {
    value: {
      type: Number,
      default: 0,
    },
    marks: {
      type: Array,
      required: true,
    },
    onChange: {
      type: Function,
      default: NOOP,
    },
  },
  watch: {
    value(val) {
      this.whenUpdateProps(this.marks, val);
    },
  },
  data() {
    return {
      classes: this.classes,
      handlerX: 0,
    };
  },
  computed: {
    currentValue() {
      return this.getCurrentValue();
    },
    colorStops() {
      return getColorStops('#ffb76c', '#f63', this.marks.length);
    },
  },
  created() {
    mixin(this);
  },
  mounted() {
    this.whenMount();
  },
  beforeDestroy() {
    this.whenUnmount();
  },
  methods: {
    handleMarkClick(e) {
      this.$emit('change', Number(e.currentTarget.dataset.index));
    },
    handleTouchStart(e) {
      this.handleTouchStart(e);
    },
    handleTouchMove(e) {
      this.handleTouchMove(e);
    },
    handleTouchEnd(e) {
      this.handleTouchEnd(e);
    },
  },
};
</script>
