<template>
  <div class="seed-num-wrap">
    <div
      v-for="(num, index) in nums"
      :class="getNumCSS(num, active)"
      :key="index"
    >
      <div class="seed-dec">{{ numArr[num.val] }}</div>
      <div class="seed-me">{{ numArr[num.val + 1] }}</div>
      <div class="seed-inc">{{ numArr[num.val + 2] }}</div>
    </div>
  </div>
</template>
<script>
import { prefixCls } from '@seed/ui-base';
import '../style/srcoll-num.less';
export default {
  name: 'scroll-num',

  data() {
    return {
      numArr: [9, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0],
      lastNum: 0,
      nums: this.getNumChange(this.count).lastNums,
    };
  },

  beforeDestroy() {
    clearTimeout(this.timeOutHandle);
  },

  props: {
    count: Number,
    active: Boolean,
  },

  watch: {
    count(newVal, oldVal) {
      if (newVal !== oldVal) {
        let { currentNums, lastNums } = this.getNumChange(newVal);
        this.timeOutHandle = setTimeout(() => {
          this.nums = currentNums;
        }, 300);
        this.nums = lastNums;
      }
    },
  },

  methods: {
    getNums(num) {
      let currentNums = num
        .toString()
        .split('')
        .map((n) => {
          return {
            val: Number(n),
          };
        });
      return currentNums;
    },

    getNumChange(count) {
      if (!this.lastNum) this.lastNum = count;
      let currentNums = this.getNums(count);
      let lastNums = this.getNums(this.lastNum);
      // 位数没有变化
      if (currentNums.length == lastNums.length) {
        // 数字变大
        if (count > this.lastNum) {
          lastNums.forEach((num, index) => {
            if (currentNums[index].val !== lastNums[index].val) {
              num.inc = true;
            }
          });
        } else if (count < this.lastNum) {
          lastNums.forEach((num, index) => {
            if (currentNums[index].val !== lastNums[index].val) {
              num.dec = true;
            }
          });
        }
      } else if (count > this.lastNum) {
        // 全部数字增加
        lastNums.forEach((n) => {
          n.inc = true;
        });
      } else {
        // 全部数字减小
        lastNums.forEach((n) => {
          n.dec = true;
        });
      }
      this.lastNum = count;
      return { lastNums, currentNums };
    },

    getNumCSS(num, active) {
      let cssName = 'seed-num ';
      if (num.inc) cssName += 'seed-increase ';
      if (num.dec) cssName += 'seed-decrease ';
      if (active) cssName += 'seed-active ';
      return cssName;
    },
  },
};
</script>
