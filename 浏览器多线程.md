# 浏览器多线程

每个标签页通常：
- 1个JS主线程
- 1个GUI渲染线程  
- 1个事件线程
- 1个定时器线程
- 多个网络线程（通常6-8个并发）
- 多个Worker线程（根据需要创建）


1.GUI渲染线程
工作流程：
- 解析HTML → 构建DOM树
- 解析CSS → 构建CSSOM树
- 结合DOM和CSSOM → 渲染树(Render Tree)
- 布局(Layout) → 计算每个元素的位置大小
- 绘制(Painting) → 填充像素
- 合成(Compositing) → 图层合并
特点：
- 与JS引擎线程互斥，60fps目标

2.JS引擎线程
特点与作用：
- 单线程执行：一次只能执行一个任务
- 执行所有JS代码：同步、异步回调、事件处理
- 管理调用栈：函数调用、执行上下文
- 与GUI渲染线程互斥：JS执行时阻塞渲染

3.事件触发线程
作用：
- 事件的调度中心和协调者，包含的事件：用户交互(click、scroll等)、网络响应(XMLHttpRequest、fetch等)、定时器(setTimeout、setIntervel等)、history变化、文件读取等
- 管理事件执行的优先级：确保用户交互优先
- 通知JS线程：唤醒JS线程处理待执行的事件

4.定时器线程
作用：
- 管理定时器：维护setTimeout/setInterval
- 计时功能：精确计时，不受JS阻塞影响
- 回调排队：时间到时将回调加入宏任务中

5.HTTP网络线程
作用：
- 处理网络请求：XMLHttpRequest、Fetch API，当监听到状态变更，fetc会将回调放到微任务队列中（因为fetch是基于Promise实现的），XMLHttpRequest、webSocket会放到宏任务中
- 并发请求：浏览器限制（同一域名6-8个并发）
- 不阻塞页面：网络IO在独立线程进行

6.Web Workder
使用场景：大数据处理、图像/视频处理、复杂计算、加密解密等
特点：
- 独立线程：不阻塞主线程
- 无法访问DOM：与渲染线程隔离
- 通过消息通信：postMessage/onmessage

7.Service Worker
特殊的Web Workder
作用：
- 网络代理：拦截和处理网络请求
- 离线支持：缓存资源，离线访问
- 后台同步：数据同步

8.合成线程
现代浏览器优化
作用：
- 图层管理：将页面分成多个图层
- GPU加速：利用显卡处理动画
- 滚动优化：独立处理滚动，流畅体验
